# RaymondsIndex v3.0 Option C 가중치 최적화 실행 계획

> **작성일**: 2026-01-22
> **작성자**: Index 전문가 분석
> **목적**: Phase 1-6 분석 결과를 바탕으로 500개 기업 데이터로 적정 가중치 도출

---

## 1. 현황 분석 (Phase 1-6 결과 요약)

### 1.1 v3.0 계산 완료 현황

| 항목 | 값 | 상태 |
|------|-----|------|
| 계산 완료 기업 | 2,501개 | ✅ 충족 (목표: 500+) |
| 실패 기업 레이블 | 1,310개 | ✅ 충족 (목표: 50+) |
| 고신뢰도 레이블 | 948개 | ✅ 충족 |

### 1.2 현재 v3.0 점수 분포 문제

```
평균 점수: 18.09점 (100점 만점)
최대 점수: 61.49점
최소 점수: 2.56점

등급 분포:
  B:    9개 (0.4%)
  B-:  43개 (1.7%)
  C+: 274개 (11.0%)
  C: 2,122개 (84.9%)  ⚠️ 과도한 집중
```

**핵심 문제**: 기하평균 집계로 인해 전체 점수가 급격히 하락, 등급 분별력 저하

### 1.3 LDA 분석 결과 (Phase 5)

```
판별분석 최적 가중치:
  CEI: 45.5% (+25.5%)  ⬆️ 자본효율성 중요
  RII:  7.3% (-27.7%)  ⬇️ 재투자율 과대평가
  CGI: 44.9% (+19.9%)  ⬆️ 지배구조 중요
  MAI:  2.3% (-17.7%)  ⬇️ 모멘텀 덜 중요

F1 Score: 0.616 (목표: 0.7 이상)
False Positive Rate: 84% (목표: 20% 이하)
```

### 1.4 백테스팅 결과 (Phase 6)

| 테스트 | 결과 | 기준 | 상태 |
|--------|------|------|------|
| F1 Score | 0.578 | ≥ 0.7 | ❌ FAIL |
| False Positive Rate | 0.840 | ≤ 0.2 | ❌ FAIL |
| 등급 안정성 | 0.000 | ≥ 0.8 | ❌ FAIL |
| 상위 10개 평균 점수 | 57.2 | ≥ 50 | ✅ PASS |
| 하위 10개 실패율 | 0.200 | ≥ 0.3 | ❌ FAIL |

**통과율**: 1/5 (20%) → 가중치 재조정 필요

---

## 2. 문제 진단

### 2.1 근본 원인 분석

```
┌─────────────────────────────────────────────────────────────────┐
│                    문제 원인 체인                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [원인 1] 기하평균 → 점수 급락                                  │
│     └─ Sub-Index 중 하나라도 낮으면 전체 점수 급락               │
│     └─ 평균 18점으로 하락 (v2.1은 50~60점 수준)                 │
│                                                                  │
│  [원인 2] 절대 등급 기준 부적합                                  │
│     └─ A++ >= 95점, A+ >= 88점 등 현재 점수 분포와 맞지 않음    │
│     └─ 대부분 C등급으로 분류                                     │
│                                                                  │
│  [원인 3] RII 가중치 과대평가                                    │
│     └─ 현재 35%지만 실패 예측에는 7.3%만 기여                   │
│     └─ 재투자율이 높은 기업도 실패하는 경우 많음                │
│                                                                  │
│  [원인 4] 실패 기업 레이블 품질                                  │
│     └─ 공시 키워드 기반 → 노이즈 포함                           │
│     └─ 연속 적자 = 실패? (성장 기업 오분류 가능)                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 핵심 인사이트

1. **CEI + CGI가 핵심**: 자본효율성과 지배구조가 실패 예측의 90% 설명
2. **RII 과대평가**: 재투자율은 실패와 상관관계 낮음 (성장 기업 역설)
3. **MAI 불필요**: 모멘텀 지표는 사실상 노이즈

---

## 3. Option C 실행 계획 (500개 기업 샘플)

### 3.1 Phase 구성

```
┌─────────────────────────────────────────────────────────────────┐
│                    Option C 실행 로드맵                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [Phase C-1] 샘플 선정 (D+1)                                    │
│     ├─ 500개 기업 층화추출                                      │
│     │   ├─ 실패 기업: 100개 (고신뢰도 레이블)                   │
│     │   └─ 정상 기업: 400개 (랜덤 샘플링)                       │
│     └─ 5년 시계열 데이터 확보                                   │
│                                                                  │
│  [Phase C-2] 레이블 고도화 (D+2~3)                              │
│     ├─ 실패 기업 재정의                                         │
│     │   ├─ 상장폐지 확정                                        │
│     │   ├─ 관리종목 지정                                        │
│     │   ├─ 횡령/배임 유죄 확정                                  │
│     │   └─ 감사의견 거절/한정                                   │
│     └─ 정상 기업 검증 (실패 이력 제외)                          │
│                                                                  │
│  [Phase C-3] 특성 엔지니어링 (D+3~4)                            │
│     ├─ Sub-Index 점수 재계산                                    │
│     ├─ 추가 파생 변수 생성                                      │
│     │   ├─ CEI × CGI 상호작용                                   │
│     │   ├─ 업종 더미 변수                                       │
│     │   └─ 규모 더미 변수                                       │
│     └─ 다중공선성 제거                                          │
│                                                                  │
│  [Phase C-4] 가중치 최적화 (D+5~7)                              │
│     ├─ Method 1: LDA (Linear Discriminant Analysis)             │
│     ├─ Method 2: Logistic Regression + L1 Regularization        │
│     ├─ Method 3: Random Forest Feature Importance               │
│     └─ 앙상블: 3개 결과 평균                                    │
│                                                                  │
│  [Phase C-5] 교차 검증 (D+8~10)                                 │
│     ├─ 5-Fold Cross Validation                                  │
│     ├─ Time-Series Split (시계열 검증)                          │
│     └─ Out-of-Sample Test (2025년 데이터)                       │
│                                                                  │
│  [Phase C-6] 등급 기준 재설정 (D+11~12)                         │
│     ├─ 상대 등급제 vs 절대 등급제 비교                          │
│     └─ 분별력 최적 임계값 탐색                                  │
│                                                                  │
│  [Phase C-7] 최종 검증 및 문서화 (D+13~14)                      │
│     ├─ 전문가 리뷰 (상위/하위 30개 수동 검증)                   │
│     ├─ 결과 문서화                                              │
│     └─ 프로덕션 적용 여부 결정                                  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 샘플 선정 기준

```python
# Phase C-1: 층화추출 전략
SAMPLE_STRATEGY = {
    'total': 500,

    'failure_group': {
        'count': 100,
        'criteria': [
            # 고신뢰도 실패 (confidence >= 0.95)
            {'type': 'DELISTED', 'count': 30},           # 상장폐지 확정
            {'type': 'EMBEZZLEMENT', 'count': 25},       # 횡령/배임
            {'type': 'CAPITAL_EROSION', 'count': 20},    # 자본잠식
            {'type': 'AUDIT_QUALIFIED', 'count': 15},    # 감사의견 한정
            {'type': 'MANAGED_STOCK', 'count': 10},      # 관리종목
        ],
    },

    'normal_group': {
        'count': 400,
        'stratify_by': ['industry', 'market_cap_decile'],
        'exclusions': [
            'has_failure_label',
            'data_quality_score < 70',
            'years_of_data < 3',
        ],
    },
}
```

### 3.3 레이블 고도화 기준

```
┌─────────────────────────────────────────────────────────────────┐
│                    실패 기업 정의 (엄격 기준)                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [Tier 1] 확정 실패 (confidence = 1.0)                          │
│     ├─ 상장폐지 확정                                            │
│     ├─ 횡령/배임 유죄 판결                                      │
│     └─ 감사의견 거절 (2년 연속)                                 │
│                                                                  │
│  [Tier 2] 고위험 (confidence = 0.9)                             │
│     ├─ 관리종목 지정                                            │
│     ├─ 자본잠식 (50% 이상)                                      │
│     └─ 감사의견 한정/거절 (1년)                                 │
│                                                                  │
│  [Tier 3] 중위험 (confidence = 0.7) - 제외                      │
│     ├─ 3년 연속 적자 (성장기업 오분류 위험)                     │
│     └─ 검찰 수사 중 (결과 미확정)                               │
│                                                                  │
│  ⚠️ Tier 3는 노이즈 유발 → 분석에서 제외                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.4 가중치 최적화 방법론

```python
# Phase C-4: 3가지 방법론 앙상블

class OptionCWeightOptimizer:
    """
    Altman Z-Score 방식 가중치 최적화

    3가지 방법의 앙상블로 과적합 방지
    """

    def method_1_lda(self, X, y) -> Dict[str, float]:
        """
        Linear Discriminant Analysis

        장점: Altman 원조 방식, 해석 가능
        단점: 선형 관계 가정
        """
        from sklearn.discriminant_analysis import LinearDiscriminantAnalysis

        lda = LinearDiscriminantAnalysis()
        lda.fit(X, y)

        # 계수의 절대값을 가중치로 변환
        abs_coef = np.abs(lda.coef_[0])
        weights = abs_coef / abs_coef.sum()

        return dict(zip(['CEI', 'RII', 'CGI', 'MAI'], weights))

    def method_2_logistic(self, X, y) -> Dict[str, float]:
        """
        Logistic Regression with L1 (Lasso)

        장점: 변수 선택 기능, 과적합 방지
        단점: 계수 해석 주의 필요
        """
        from sklearn.linear_model import LogisticRegressionCV

        model = LogisticRegressionCV(
            penalty='l1',
            solver='saga',
            cv=5,
            max_iter=1000
        )
        model.fit(X, y)

        abs_coef = np.abs(model.coef_[0])
        weights = abs_coef / abs_coef.sum()

        return dict(zip(['CEI', 'RII', 'CGI', 'MAI'], weights))

    def method_3_rf_importance(self, X, y) -> Dict[str, float]:
        """
        Random Forest Feature Importance

        장점: 비선형 관계 포착, 안정적
        단점: 블랙박스
        """
        from sklearn.ensemble import RandomForestClassifier

        rf = RandomForestClassifier(
            n_estimators=100,
            max_depth=5,
            random_state=42
        )
        rf.fit(X, y)

        importance = rf.feature_importances_
        weights = importance / importance.sum()

        return dict(zip(['CEI', 'RII', 'CGI', 'MAI'], weights))

    def ensemble_weights(self, X, y) -> Dict[str, float]:
        """
        3가지 방법의 가중 평균

        가중치: LDA(0.4) + Logistic(0.3) + RF(0.3)
        """
        w1 = self.method_1_lda(X, y)
        w2 = self.method_2_logistic(X, y)
        w3 = self.method_3_rf_importance(X, y)

        ensemble = {}
        for key in ['CEI', 'RII', 'CGI', 'MAI']:
            ensemble[key] = (
                0.4 * w1[key] +
                0.3 * w2[key] +
                0.3 * w3[key]
            )

        return ensemble
```

### 3.5 교차 검증 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                    교차 검증 전략                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [전략 1] K-Fold Cross Validation (k=5)                         │
│     ├─ 500개 → 400 train + 100 test (5회 반복)                  │
│     ├─ 평균 F1 Score 및 표준편차 산출                           │
│     └─ 표준편차 < 0.05 목표 (안정성 확보)                       │
│                                                                  │
│  [전략 2] Time-Series Split                                      │
│     ├─ 2020-2022 데이터 → Train                                 │
│     ├─ 2023 데이터 → Validation                                 │
│     └─ 2024 데이터 → Test                                       │
│                                                                  │
│  [전략 3] Stratified K-Fold                                      │
│     ├─ 실패 기업 비율 유지 (20%)                                │
│     └─ 업종별 비율 유지                                         │
│                                                                  │
│  [합격 기준]                                                     │
│     ├─ 평균 F1 Score >= 0.7                                     │
│     ├─ 표준편차 <= 0.05                                         │
│     ├─ AUC-ROC >= 0.75                                          │
│     └─ False Positive Rate <= 0.3                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.6 등급 기준 재설정

```python
# Phase C-6: 두 가지 등급 체계 비교

GRADE_SYSTEMS = {
    'absolute_relaxed': {
        # 현재 점수 분포에 맞춘 절대 기준 (20점 완화)
        'thresholds': [
            (75, 'A++'),   # 상위 ~0%
            (68, 'A+'),    # 상위 ~1%
            (60, 'A'),     # 상위 ~3%
            (52, 'A-'),    # 상위 ~5%
            (44, 'B+'),    # 상위 ~10%
            (35, 'B'),     # 상위 ~20%
            (25, 'B-'),    # 상위 ~40%
            (15, 'C+'),    # 상위 ~65%
            (0, 'C'),      # 나머지
        ],
    },

    'relative': {
        # 백분위 기반 상대 등급 (권장)
        'percentiles': {
            'A++': 95,   # 상위 5%
            'A+': 90,    # 상위 10%
            'A': 80,     # 상위 20%
            'A-': 70,    # 상위 30%
            'B+': 55,    # 상위 45%
            'B': 40,     # 상위 60%
            'B-': 25,    # 상위 75%
            'C+': 10,    # 상위 90%
            'C': 0,      # 하위 10%
        },
    },
}

# 현재 v3.0 점수 분포 기준 상대 등급 임계값
RELATIVE_THRESHOLDS_V3 = {
    'A++': 38.9,   # 상위 5%
    'A+': 32.3,    # 상위 10%
    'A': 25.9,     # 상위 20%
    'A-': 21.3,    # 상위 30%
    'B+': 18.2,    # 상위 40%
    'B': 15.8,     # 상위 50%
    'B-': 13.5,    # 상위 60%
    'C+': 10.4,    # 상위 75%
    'C': 0,        # 하위 25%
}
```

---

## 4. 예상 결과 및 권장안

### 4.1 가중치 변경 예상

| 지표 | 현재 | Phase 5 LDA | Option C 예상 | 변경 방향 |
|------|------|-------------|---------------|-----------|
| CEI | 20% | 45.5% | **40~45%** | ⬆️ 대폭 상향 |
| RII | 35% | 7.3% | **10~15%** | ⬇️ 대폭 하향 |
| CGI | 25% | 44.9% | **35~40%** | ⬆️ 상향 |
| MAI | 20% | 2.3% | **5~10%** | ⬇️ 하향 |

### 4.2 권장안

```
┌─────────────────────────────────────────────────────────────────┐
│                    Option C 권장 가중치                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🎯 권장 가중치 (앙상블 결과 예상치):                           │
│                                                                  │
│     CEI: 40% (±5%)  - 자본효율성 핵심                           │
│     CGI: 35% (±5%)  - 지배구조 핵심                             │
│     RII: 15% (±5%)  - 재투자율 보조                             │
│     MAI: 10% (±3%)  - 모멘텀 보조                               │
│                                                                  │
│  📊 등급 체계:                                                   │
│     - 상대 등급제 채택 (백분위 기반)                             │
│     - 분기별 임계값 업데이트                                     │
│                                                                  │
│  ⚠️ 프로덕션 적용 조건:                                         │
│     - F1 Score >= 0.7                                           │
│     - AUC-ROC >= 0.75                                           │
│     - 전문가 리뷰 통과                                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 리스크 및 완화 방안

| 리스크 | 영향 | 완화 방안 |
|--------|------|-----------|
| 과적합 | 테스트 데이터에서 성능 저하 | 앙상블 + 정규화 |
| 레이블 노이즈 | 가중치 왜곡 | Tier 3 제외, 고신뢰도만 |
| 시장 변화 | 가중치 유효성 상실 | 연간 재학습 체계 |
| 업종 편향 | 특정 업종 불리 | 업종별 정규화 검토 |

---

## 5. 실행 일정

```
Week 1 (D+1~7):
  ├─ D+1:   Phase C-1 샘플 선정
  ├─ D+2~3: Phase C-2 레이블 고도화
  ├─ D+3~4: Phase C-3 특성 엔지니어링
  └─ D+5~7: Phase C-4 가중치 최적화

Week 2 (D+8~14):
  ├─ D+8~10:  Phase C-5 교차 검증
  ├─ D+11~12: Phase C-6 등급 기준 재설정
  └─ D+13~14: Phase C-7 최종 검증 및 문서화
```

---

## 6. 성공 기준

| 지표 | 현재 | 목표 | 합격 기준 |
|------|------|------|-----------|
| F1 Score | 0.578 | 0.75 | >= 0.70 |
| AUC-ROC | - | 0.80 | >= 0.75 |
| False Positive Rate | 0.84 | 0.20 | <= 0.30 |
| 등급 엔트로피 | 0.66 | 2.0 | >= 1.8 |
| 전문가 동의율 | - | 80% | >= 70% |

---

## 7. 다음 단계

### 즉시 실행 가능:
1. `scripts/analysis/option_c_optimize.py` 스크립트 생성
2. 500개 샘플 선정 쿼리 실행
3. 레이블 고도화 (Tier 1, 2만 사용)

### 추가 논의 필요:
1. 상대 등급제 vs 절대 등급제 최종 결정
2. 업종별 가중치 차별화 여부
3. 프로덕션 적용 시점 및 롤백 계획

---

**결론**: 현재 v3.0 가중치(RII 35%)는 실패 예측에 부적합합니다. Option C를 통해 **CEI+CGI 중심(75~80%)**으로 가중치를 재조정하면 예측력이 크게 개선될 것으로 예상됩니다.
