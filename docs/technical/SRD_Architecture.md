# Raymontology 시스템 아키텍처

> System Requirements Document (SRD) - 버전 1.0 | 최종 수정: 2026-01-23

---

## 1. 시스템 개요

### 1.1 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              CLIENT LAYER                                    │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐        │
│  │    RISK-WEB       │  │    INDEX-WEB      │  │    RISK-APP       │        │
│  │ Vite + React 18   │  │ Next.js 16        │  │ Vite + React 18   │        │
│  │ D3.js + Tailwind  │  │ React 19 + Recharts│  │ Toss SDK         │        │
│  │ www.konnect-ai.net│  │ raymondsindex...  │  │ intoss://        │        │
│  └─────────┬─────────┘  └─────────┬─────────┘  └─────────┬─────────┘        │
└────────────│────────────────────────│────────────────────│──────────────────┘
             │                        │                    │
             └────────────────────────┼────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                               API LAYER                                      │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         FastAPI (Python 3.11)                          │  │
│  │                                                                        │  │
│  │  /api/companies      /api/graph         /api/raymonds-index           │  │
│  │  /api/risks          /api/stock-prices  /api/auth                     │  │
│  │  /api/financials     /api/news          /api/subscriptions            │  │
│  │                                                                        │  │
│  │                 https://raymontology-production.up.railway.app         │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              DATA LAYER                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐  │
│  │   PostgreSQL    │  │     Neo4j       │  │          Redis              │  │
│  │   (Railway)     │  │   (Optional)    │  │        (Optional)           │  │
│  │                 │  │                 │  │                             │  │
│  │  • 26 테이블    │  │  • Company 노드 │  │  • API 응답 캐시            │  │
│  │  • 3,109 기업   │  │  • Officer 노드 │  │  • 세션 관리                │  │
│  │  • 47,444 임원  │  │  • 관계 그래프  │  │                             │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 기술 스택 상세

### 2.1 프론트엔드

| 앱 | 프레임워크 | 상태관리 | 스타일링 | 차트/그래프 |
|----|-----------|---------|----------|------------|
| RISK-WEB | Vite + React 18 | Zustand + TanStack Query | Tailwind CSS | D3.js |
| INDEX-WEB | Next.js 16 + React 19 | Zustand + TanStack Query | Tailwind CSS | Recharts |
| RISK-APP | Vite + React 18 | Zustand + TanStack Query | Emotion + TDS | D3.js |

### 2.2 백엔드

| 카테고리 | 기술 | 버전 |
|----------|------|------|
| 웹 프레임워크 | FastAPI | 최신 |
| ORM | SQLAlchemy | 2.x |
| 인증 | JWT + OAuth2 | - |
| 스케줄링 | APScheduler | - |
| 로깅 | Loguru | - |

### 2.3 데이터베이스

| 데이터베이스 | 용도 | 호스팅 |
|-------------|------|--------|
| PostgreSQL | 주 데이터 저장소 | Railway |
| Neo4j | 그래프 쿼리 (선택) | Self-hosted |
| Redis | 캐시 (선택) | Railway |

### 2.4 인프라

| 서비스 | 용도 | 제공자 |
|--------|------|--------|
| 호스팅 | API 서버 | Railway |
| 도메인 | konnect-ai.net | - |
| SSL | HTTPS | Railway |
| 모니터링 | 로그/메트릭 | Railway |

---

## 3. 데이터 흐름

### 3.1 데이터 수집 파이프라인

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   DART API   │────▶│   다운로드   │────▶│   ZIP 저장   │
│              │     │              │     │  data/dart/  │
└──────────────┘     └──────────────┘     └──────┬───────┘
                                                 │
                                                 ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  PostgreSQL  │◀────│    파싱      │◀────│  ZIP 압축    │
│   테이블     │     │  (parsers/)  │     │   해제       │
└──────┬───────┘     └──────────────┘     └──────────────┘
       │
       ▼
┌──────────────┐     ┌──────────────┐
│    Neo4j     │◀────│   동기화     │
│   그래프     │     │  (sync/)     │
└──────────────┘     └──────────────┘
```

### 3.2 분기별 파이프라인 단계

| 단계 | 스크립트 | 설명 |
|------|----------|------|
| 1 | `download_quarterly_reports.py` | DART에서 보고서 다운로드 |
| 2 | `run_unified_parser.py` | 통합 파서로 데이터 추출 |
| 3 | `validate_parsed_data.py` | 데이터 품질 검증 |
| 4 | `calculate_index.py` | RaymondsIndex 계산 |
| 5 | `generate_report.py` | 실행 보고서 생성 |

### 3.3 API 요청 흐름

```
클라이언트
    │
    ▼
┌──────────────────────────────────────────────────────────────┐
│  FastAPI Router                                              │
│  • 인증 미들웨어 (JWT 검증)                                  │
│  • 요청 검증 (Pydantic)                                      │
└──────────────────────────────────────────────────────────────┘
    │
    ▼
┌──────────────────────────────────────────────────────────────┐
│  Service Layer                                               │
│  • 비즈니스 로직                                             │
│  • 조회 제한 확인 (usage_service)                            │
│  • 캐시 조회 (cache_service)                                 │
└──────────────────────────────────────────────────────────────┘
    │
    ▼
┌──────────────────────────────────────────────────────────────┐
│  Data Layer                                                  │
│  • SQLAlchemy ORM 쿼리                                       │
│  • Neo4j 그래프 쿼리 (또는 PostgreSQL 폴백)                  │
└──────────────────────────────────────────────────────────────┘
```

---

## 4. 인증 시스템

### 4.1 인증 방식

| 방식 | 설명 | 사용처 |
|------|------|--------|
| JWT | Access Token + Refresh Token | 모든 클라이언트 |
| OAuth2 | Google, Kakao, Naver | 웹 소셜 로그인 |
| Toss Login | 토스 앱 인증 | 앱인토스 |

### 4.2 인증 흐름

```
┌──────────┐     ┌──────────┐     ┌──────────┐
│  로그인  │────▶│  인증    │────▶│ JWT 발급 │
│  요청    │     │  검증    │     │          │
└──────────┘     └──────────┘     └────┬─────┘
                                       │
                                       ▼
┌──────────┐     ┌──────────┐     ┌──────────┐
│  API     │◀────│  토큰    │◀────│  클라    │
│  응답    │     │  검증    │     │  이언트  │
└──────────┘     └──────────┘     └──────────┘
```

---

## 5. 배포 아키텍처

### 5.1 Railway 배포

```
┌─────────────────────────────────────────────────────────────┐
│                        Railway                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  raymontology-production                              │   │
│  │                                                       │   │
│  │  • FastAPI 서버 (Dockerfile)                          │   │
│  │  • 환경 변수 관리                                     │   │
│  │  • 자동 배포 (main 브랜치)                            │   │
│  │  • SSL/HTTPS                                          │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  PostgreSQL                                           │   │
│  │                                                       │   │
│  │  • 프로덕션 데이터베이스                              │   │
│  │  • 자동 백업                                          │   │
│  │  • 연결 풀링                                          │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 프론트엔드 배포

| 앱 | 빌드 | 호스팅 |
|----|------|--------|
| RISK-WEB | `npm run build` | Railway / Vercel |
| INDEX-WEB | `npm run build` | Railway |
| RISK-APP | `npm run granite:build` | 토스 앱스토어 |

---

## 6. 보안

### 6.1 보안 헤더

| 헤더 | 값 | 설명 |
|------|-----|------|
| HSTS | max-age=31536000 | HTTPS 강제 |
| X-Content-Type-Options | nosniff | MIME 타입 스니핑 방지 |
| X-Frame-Options | DENY | 클릭재킹 방지 |
| CSP | script-src 'self' | XSS 방지 |

### 6.2 데이터 보호

- 비밀번호: bcrypt 해싱
- API 키: 환경 변수로 관리
- 민감 데이터: HTTPS 전송

---

## 7. 모니터링

### 7.1 로깅

| 레벨 | 용도 |
|------|------|
| INFO | 정상 요청/응답 |
| WARNING | 비정상 상황 (조회 제한 초과 등) |
| ERROR | 예외 발생 |

### 7.2 메트릭

| 메트릭 | 설명 |
|--------|------|
| 요청 수 | API 엔드포인트별 요청 수 |
| 응답 시간 | 평균/P95/P99 응답 시간 |
| 에러율 | 5xx 에러 비율 |

---

## 8. 확장성

### 8.1 수평 확장

- Railway 인스턴스 복제
- 로드 밸런싱

### 8.2 수직 확장

- 데이터베이스 리소스 증가
- Redis 캐시 도입

### 8.3 캐싱 전략

| 데이터 | 캐시 TTL | 위치 |
|--------|----------|------|
| 기업 목록 | 1시간 | Redis |
| 관계망 그래프 | 30분 | Redis |
| RaymondsIndex | 1일 | Redis |

---

## 9. 관련 문서

- [DB 스키마](SRD_Database.md)
- [BACKEND README](../apps/backend/README.md)
- [데이터 현황](../data/DATA_STATUS.md)

---

*마지막 업데이트: 2026-01-23*
